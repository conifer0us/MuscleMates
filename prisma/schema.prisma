generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:../build/active.db"
}

model Cookie {
  id  Int     @id @default(autoincrement())
  username    String 
  cookieval   String @unique
  user        User   @relation("cookies", fields: [username], references: [username])
}

model Friends{
  id              Int  @id @default(autoincrement())
  friend          User @relation("friend", fields: [friendName], references: [username])
  friendName      String
  friendAdded     User @relation("friendAdded", fields: [friendAddedName], references: [username])
  friendAddedName String
  messages        Messages[] @relation("group")
  @@unique([friendAddedName, friendName])
}

model Messages {
  id              Int @id @default(autoincrement())
  group           Friends @relation("group", fields: [user1, user2], references: [friendName, friendAddedName])
  user1           String
  user2           String
  timesent        DateTime
}

model MatchRequest {
  id Int        @id @default(autoincrement())
  sender        User @relation("sender", fields: [senderName], references: [username], onUpdate: NoAction)  
  senderName    String 
  receiver      User @relation("receiver", fields: [receiverName], references: [username], onUpdate: NoAction)
  receiverName String
}

model Profile {
  id Int      @id @default(autoincrement())
  username    String @unique
  name        String?
  age         String?
  bio         String?
  gym         String?
  user        User   @relation("userProfile", fields: [username], references: [username], onDelete: Cascade)
}

model User {
  id                      Int           @id @default(autoincrement())
  username                String       @unique
  useremail               String?       @unique
  passwordhash            String?
  profile                 Profile? @relation("userProfile")
  friends                 Friends[] @relation("friend")
  friendsAdded            Friends[] @relation("friendAdded")            
  cookies                 Cookie[] @relation("cookies")
  requestsSent            MatchRequest[] @relation("sender")
  requestsReceived        MatchRequest[] @relation("receiver")
}